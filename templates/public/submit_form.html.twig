{# templates/public/competition_submit.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}
    {{ competition.title }}
    - Δήλωση Συμμετοχής
{% endblock %}

{% block body %}

    {{ render(controller('App\\Controller\\Public\\AnnouncementController::announcementsFragment')) }}

    {# Add this block to render the custom message #}
    {% if message is not empty %}
        {% set bgColorClass = 'bg-blue-100 border-blue-400 text-blue-700' %}
        {% if message.type == 'success' %}
            {% set bgColorClass = 'bg-green-100 border-green-400 text-green-700' %}
        {% elseif message.type == 'error' %}
            {% set bgColorClass = 'bg-red-100 border-red-400 text-red-700' %}
        {% elseif message.type == 'warning' %}
            {% set bgColorClass = 'bg-yellow-100 border-yellow-400 text-yellow-700' %}
        {% endif %}

        <div class="relative px-4 py-3 mb-4 rounded border {{ bgColorClass }}" role="alert">
            <strong class="font-bold">{{ message.type|capitalize }}!</strong>
            <span class="block sm:inline ml-2">{{ message.text|raw }}</span>
        </div>
    {% endif %}

    <div class="container mx-auto p-4 font-sans antialiased">
        {# The main "bigger container" #}
        <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 mb-8">
            <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">
				 Δήλωση Συμμετοχής
            </h1>

            {# The grid container #}
            {#
                'items-start' ensures the content inside each column starts at the top.
                The 'h-full' on the child divs will make the background containers span the full height of the row.
            #}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                {# Left Column: Competition Item in its own card #}
                <div class="md:col-span-1 bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-100 h-full">
                    {% include 'public/_competition_item.html.twig' with {
                        'competition': competition,
                        'statusLabels': statusLabels
                    } %}
                </div>

                {# Right Column: Form in its own card #}
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-full">
                    {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

                    {% for child in form.children %}
                        {% if child.vars.name != 'submit' and child.vars.name != 'competition_id' %}
                            <div class="form-group">
                                {{ form_row(child, {
                                        'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'},
                                        'attr': {
                                            'class': 'block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base'
                                        }
                                    }) }}
                            </div>
                        {% endif %}
                    {% endfor %}

                    {{ form_widget(form.competition_id) }}

                    <button type="submit" class="mt-8 w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-300 text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 shadow-md">
                        {{ form.submit.vars.label }}
                    </button>

                    {{ form_end(form, {'render_rest': false}) }}
                </div>
            </div>
        </div> {# End of the main colored container #}

        {# Back to list link, centered below the two columns #}
        <p class="text-center mt-8">
            <a href="{{ path('public_competitions_list') }}" class="inline-block text-blue-600 hover:underline hover:text-blue-800 transition-colors duration-300">
                <i class="fa-solid fa-arrow-left mr-2"></i>Επιστροφή στη λίστα διαγωνισμών
            </a>
        </p>
    </div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}

	<script type="module">
		
		import { initializeAnnouncementsMercure } from 'announcements'; 

		const mercurePublicUrl = "{{ mercure_public_url }}";
		
		initializeAnnouncementsMercure(mercurePublicUrl);


	</script>
{% endblock %}